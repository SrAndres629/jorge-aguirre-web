# ü§ñ AI AGENT OPERATING GUIDE - Jorge Aguirre Web

## üß¨ Project Overview
This project is a high-performance web architecture combining **FastAPI (Python)**, **n8n (Automation)**, **Evolution API (WhatsApp SDK)**, and **Supabase (PostgreSQL)**.

## üß† System Abstraction for Agents
As an AI Agent auditing or modifying this system, you must respect the following architectural pillars:

### 1. Hybrid Persistence Layer (`core/app/database.py`)
- The system supports both **PostgreSQL** (Production/Cloud) and **SQLite** (Development/Local Fallback).
- Always check the `BACKEND` variable before performing DDL or complex queries.
- SQL queries and schema must be compatible with both engines or use the `BACKEND` conditional logic.

### 2. Async Tracking Engine (`core/app/tasks.py` & `core/app/tracking.py`)
- Web tracking (Meta CAPI, n8n) is **Non-Blocking**.
- All external calls are delegated to Celery workers.
- **NEVER** add synchronous external requests in the request/response cycle of the API.

### 3. Senior Frontend Architecture (`core/static/js/tracking.js`)
- Uses `IntersectionObserver` for `ViewContent` events with a 3-second dwell time to prevent bot-triggering and ensure data quality.
- Implements a `Debug Mode` (`?debug_pixel=1`). Use it during testing.

## üîç Audit & Debugging Protocol
- **Check Logs First**: Backend logs are in `worker` and `tracking` loggers.
- **N8N Flows**: Workflows are stored in `automation/workflows_json`. If a webhook fails, check the URL in `Settings` (`core/app/config.py`).
- **Evolution API**: Handles the WhatsApp communication. Check `EVOLUTION_API_URL` and `EVOLUTION_API_KEY`.

## üõ†Ô∏è Modification Guidelines
1. **Idempotency**: Ensure all tracking and database operations are idempotent.
2. **Context Persistence**: Always update `STRUCTURE.md` or relevant audit files after making structural changes.
3. **Environment Isolation**: Prefer `os.getenv` over hardcoding. Validate inputs via Pydantic models in routes.

---
*Generated by Antigravity for future versions of myself.*
